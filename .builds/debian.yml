image: debian/buster
packages:
  - curl
  - git
  - tar
  - ripgrep
  - fd-find
  - clang
tasks:
  - build-emacs: |
      curl --remote-name https://ftp.gnu.org/pub/gnu/emacs/emacs-26.3.tar.gz
      tar -zxvf emacs-26.3.tar.gz
      cd emacs-26.3
      # Add the sources to the sources.list
      echo "deb-src http://deb.debian.org/debian/ buster main" \
          | sudo tee -a /etc/apt/sources.list
      sudo apt-get -y update  && sudo apt-get -y build-dep emacs-lucid
      ./configure --with-x-toolkit=lucid --with-modules
      make && sudo make install
  - doom-install: |
      # sudo apt-get install git ripgrep tar fd-find clang
      git clone --depth 1 https://github.com/hlissner/doom-emacs ~/.emacs.d
      mv dvm-emacs ~/.doom.d
      ~/.emacs.d/bin/doom -y install
      ~/.emacs.d/bin/doom -y sync
  - doom-doctor: |
      ~/.emacs.d/bin/doom doctor
